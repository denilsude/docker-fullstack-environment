# Define um "grupo" de servidores para o frontend
upstream frontend {
    # Aponta para o serviço 'frontend_service' na sua porta interna (5173)
    server frontend_service:5173;
}

# Define um "grupo" de servidores para o backend
upstream backend {
    # Aponta para o serviço 'backend_service' na sua porta interna (3000)
    server backend_service:3000;
}

server {
    # O Nginx vai escutar na porta 80 (padrão HTTP)
    listen 80;

    # Regra 1: Para qualquer requisição na raiz "/"
    location / {
        # Envia a requisição para o grupo 'frontend'
        proxy_pass http://frontend;
    }

    # Regra 2: Para qualquer requisição que comece com "/api/"
    location /api/ {
        # Reescreve a URL: remove o "/api" do início antes de enviar ao backend
        # Ex: /api/users vira /users. Isso cumpre um requisito do exercício.
        rewrite /api/(.*) /$1 break;

        # Envia a requisição (já reescrita) para o grupo 'backend'
        proxy_pass http://backend;
    }
}